# DOCUMENT_TYPE: REQUIREMENT
# REQ_ID: REQ-007
# VERSION: 1.0

## 1. Summary

- Title: Tag Entity Definition
- Type: data
- Priority: medium
- Status: implemented

## 2. Description

The **Tag** entity represents a label or keyword that can be associated with various system objects (e.g., articles, products) to facilitate categorization and search. Tags are system-wide entities that support localization for their display names.

## 3. Data Model

### Attributes

| Attribute | Type | Constraints | Description |
| :--- | :--- | :--- | :--- |
| **Id** | UUID | Primary Key | Unique identifier for the tag. Automatically generated. |
| **Code** | Text | Unique, Not Null | A system-unique slug or code for the tag (e.g., `technology`, `ai-agents`). Used for URLs and API lookups. |
| **Name** | JSONB | Not Null, Default `{}` | Localized display name of the tag. Follows **ADR-0002**. |

### Localization Strategy (ADR-0002)

The `Name` attribute is stored as a JSONB object containing language codes as keys and localized strings as values.

**Example:**
```json
{
  "en": "Technology",
  "ru": "Технологии",
  "kk": "Технологиялар"
}
```

## 4. Acceptance Criteria

### Data Integrity
- AC-1: The `Code` attribute must be unique across the system. Attempting to create a duplicate code must fail.
- AC-2: The `Name` attribute must be a valid JSONB object.
- AC-3: The `Id` is automatically generated upon creation if not provided.

### Localization
- AC-4: The system can retrieve the tag name in a specific language by querying the JSONB column (e.g., `name->>'en'`).
- AC-5: If a requested language is missing, the system should fall back to a default language (e.g., 'en') or return the raw JSON (implementation detail).

### API Representation
- AC-6: The API should expose the `name` as a localized string based on the user's locale, OR return the full map if requested.

## 5. Non-Functional Constraints

- **Performance**: Queries filtering by `Code` must be indexed and fast.
- **Scalability**: The design should support adding new languages without schema changes (inherent to JSONB).

## 6. Implementation Status

### Database Schema
- ✅ Table `tags` created with columns `id` (UUID), `code` (TEXT), `name` (JSONB).
- ✅ Unique index on `code`.
- ✅ Migration file: `api/migrations/000001_create_tags_table.up.sql`.

### Backend Implementation
- ✅ Repository: `api/internal/modules/tags/repository.go` (PostgreSQL implementation).
- ✅ Service: `api/internal/modules/tags/service.go`.
- ✅ Handler: `api/internal/modules/tags/handler.go`.
- ✅ Integration Tests: `api/internal/modules/tags/repository_integration_test.go` (using Test Containers).

## 7. UI Specification

> **Design Subsystem Files:**
> - UI Manifest: [`docs/design/pages/UI-REQ-007-tags.json`](../design/pages/UI-REQ-007-tags.json)
> - Components: [`docs/design/components/COMPONENT-REGISTRY.json`](../design/components/COMPONENT-REGISTRY.json)
> - Design Tokens: [`docs/design/tokens/DESIGN-TOKENS.json`](../design/tokens/DESIGN-TOKENS.json)

Refer to the linked JSON files for detailed UI component structure, styling classes, and layout specifications.

## 8. Traceability

- Product Brief Feature(s): F-Tags
- Related ADRs:
  - [ADR-0002: Database Localization Strategy](../adr/ADR-0002-database-localization.md)
- Related Modules:
  - MOD-BE-Tags
- Related Tests:
  - `api/internal/modules/tags/repository_integration_test.go` (Backend Integration)
  - `web/tests/tags.spec.ts` (E2E)
