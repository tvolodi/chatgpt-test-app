# DOCUMENT_TYPE: REQUIREMENT
# REQ_ID: REQ-016
# VERSION: 1.0

## 1. Summary

- Title: Article Likes & Dislikes System
- Type: Functional
- Priority: high
- Status: **implemented**

## 2. Description

Users can express their opinion on articles by liking or disliking them. Each user can only have one active reaction per article (like OR dislike). Users can change their reaction or remove it entirely. The system displays aggregate counts. Backend APIs already exist.

## 3. User Stories

- **US-16.1**: As a visitor, I want to see the total likes and dislikes on an article to gauge its reception.
- **US-16.2**: As an authenticated user, I want to like an article to show my appreciation.
- **US-16.3**: As an authenticated user, I want to dislike an article to express disagreement.
- **US-16.4**: As an authenticated user, I want to change my reaction (switch from like to dislike or vice versa).
- **US-16.5**: As an authenticated user, I want to remove my reaction entirely.
- **US-16.6**: As an authenticated user, I want to see which reaction I've made on an article.

## 4. Technical Specifications

### 4.1 Backend API (Already Implemented)

| Method | Endpoint | Auth | Description |
|--------|----------|------|-------------|
| GET | `/api/articles/{id}/interactions` | No | Get likes/dislikes counts |
| POST | `/api/articles/{id}/like` | Yes | Add or update like/dislike |
| DELETE | `/api/articles/{id}/like` | Yes | Remove like/dislike |

### 4.2 Request/Response Schemas

**POST /api/articles/{id}/like**
```json
Request:
{
  "is_like": true  // true = like, false = dislike
}

Response: 204 No Content
```

**DELETE /api/articles/{id}/like**
```json
Response: 204 No Content
```

**GET /api/articles/{id}/interactions**
```json
Response (200):
{
  "likes": 42,
  "dislikes": 5
}
```

### 4.3 Database Schema

```sql
CREATE TABLE article_likes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  article_id UUID NOT NULL REFERENCES articles(id),
  user_id UUID NOT NULL,
  is_like BOOLEAN NOT NULL, -- true = like, false = dislike
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(article_id, user_id)
);
```

### 4.4 Frontend Components

| Component | Location | Description |
|-----------|----------|-------------|
| `LikeDislikeButtons` | `web/src/components/articles/LikeDislikeButtons.tsx` | Like/Dislike button pair with counts |

## 5. Wireframes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Article Content                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ [ğŸ‘ Like (42)]  [ğŸ‘ Dislike (5)]                            â”‚
â”‚    â†‘ Active state shows filled icon and count               â”‚
â”‚                                                             â”‚
â”‚ States:                                                     â”‚
â”‚ - Not logged in: Buttons visible but click prompts login    â”‚
â”‚ - Logged in, no reaction: Buttons show outline icons        â”‚
â”‚ - Logged in, liked: Like button filled, dislike outline     â”‚
â”‚ - Logged in, disliked: Dislike button filled, like outline  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 6. Acceptance Criteria

### AC-16.1: Interaction Display
- **AC-16.1.1**: Like count is displayed next to the like button
- **AC-16.1.2**: Dislike count is displayed next to the dislike button
- **AC-16.1.3**: Counts update immediately after user action (optimistic UI)
- **AC-16.1.4**: Zero counts display as "0" not hidden

### AC-16.2: Like/Dislike Actions
- **AC-16.2.1**: Clicking like when not reacted adds a like
- **AC-16.2.2**: Clicking dislike when not reacted adds a dislike
- **AC-16.2.3**: Clicking like when already liked removes the like
- **AC-16.2.4**: Clicking dislike when already disliked removes the dislike
- **AC-16.2.5**: Clicking like when disliked switches to like (removes dislike, adds like)
- **AC-16.2.6**: Clicking dislike when liked switches to dislike (removes like, adds dislike)

### AC-16.3: Authentication
- **AC-16.3.1**: Unauthenticated users see buttons but clicking shows login prompt
- **AC-16.3.2**: User's current reaction is visually indicated (filled vs outline icon)
- **AC-16.3.3**: User's reaction persists across page reloads

### AC-16.4: Visual Feedback
- **AC-16.4.1**: Buttons show loading state during API calls
- **AC-16.4.2**: Icons change immediately on click (optimistic update)
- **AC-16.4.3**: On API error, revert to previous state and show error

### AC-16.5: i18n Support
- **AC-16.5.1**: Button labels use translation keys
- **AC-16.5.2**: Tooltips (if any) are localized

## 7. Dependencies

| REQ_ID | Description |
|--------|-------------|
| REQ-001 | User login (for authenticated reactions) |
| REQ-013 | Article view (reactions displayed on article page) |

## 8. Test Traceability

| Test ID | Type | Acceptance Criteria |
|---------|------|---------------------|
| TC-E2E-016.1 | E2E | AC-16.1.1, AC-16.1.2, AC-16.1.4 |
| TC-E2E-016.2 | E2E | AC-16.2.1 through AC-16.2.6 |
| TC-E2E-016.3 | E2E | AC-16.3.1, AC-16.3.2, AC-16.3.3 |
| TC-INT-016.1 | Integration | Backend like toggle logic |

## 9. Implementation Notes

### For AI Agents

1. **Backend Status**: APIs already implemented in `api/internal/modules/articles/handler.go`
2. **User Reaction State**: Need API to get current user's reaction (may need to add)
3. **Optimistic Updates**: Update UI immediately, revert on error
4. **Icons**: Use Heroicons or similar - `HandThumbUpIcon`, `HandThumbDownIcon`
