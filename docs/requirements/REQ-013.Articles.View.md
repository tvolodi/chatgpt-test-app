# DOCUMENT_TYPE: REQUIREMENT
# REQ_ID: REQ-013
# VERSION: 1.0

## 1. Summary

- Title: Public Article View & Interaction
- Type: Functional
- Priority: High
- Status: **DRAFT**

## 2. Description

This requirement covers the detailed view of an article and user interactions.
It introduces a **Master-Detail** layout for the `/articles` page, where the list of articles serves as the "Master" view and the selected article is displayed in a "Detail" panel on the same page.
It also adds social interactions: **Likes/Dislikes** and **Comments**.

## 3. User Stories

- **US-13.1**: As a visitor, I want to view the full content of an article with proper formatting so I can read it comfortably.
- **US-13.2**: As a visitor, I want to see the article list and the selected article side-by-side (or in a split view) so I can easily switch between articles without navigating back and forth.
- **US-13.3**: As a visitor, I want to see which article is currently selected in the list.
- **US-13.4**: As a visitor, I want to "Like" or "Dislike" an article to express my opinion.
- **US-13.5**: As a visitor, I want to leave a comment on an article to engage in discussion.
- **US-13.6**: As a visitor, when I click "Read more" on the home page, I want to be taken to the specific article in the Master-Detail view.
- **US-13.7**: As a visitor, I want to filter articles by category so I can view only articles in topics I'm interested in.
- **US-13.8**: As a visitor, I want to filter articles by tags so I can find articles on specific subjects.
- **US-13.9**: As a visitor, I want to apply multiple tag filters simultaneously to narrow down my search.

## 4. Technical Specifications

### 4.1. Frontend (Next.js)
- **Page**: Refactor `web/src/app/[locale]/articles/page.tsx` to support Master-Detail layout.
    - **Layout**: Split screen (e.g., Left: List (30%), Right: Detail (70%)) on desktop. Stacked or Modal on mobile.
    - **State**: URL state management (e.g., `?id=...` or `/articles/[id]` keeping the layout).
    - **Filters**: Category and tag filters above article list. Collapsible drawer on mobile.
- **Components**:
    - `ArticleDetailPanel`: Displays rendered Markdown, Author, Date, Tags.
    - `LikeDislikeControl`: Buttons for Like/Dislike with counters.
    - `CommentSection`: List of comments and a form to add new ones.
    - `CategoryFilter`: Display category chips with counts.
    - `TagFilter`: Display tag chips with counts (10-15 initially, expandable).
    - `ActiveFilters`: Show selected filters with clear buttons.
- **Navigation**:
    - "Read more" on Landing Page -> Navigates to `/articles?selectedId=...` (or similar).

### 4.2. Backend (Go)
- **API**:
    - `GET /api/articles/{id}`: Fetch single article details (public).
    - `POST /api/articles/{id}/likes`: Toggle Like/Dislike.
    - `DELETE /api/articles/{id}/likes`: Remove Like/Dislike.
    - `GET /api/articles/{id}/comments`: Fetch comments for an article.
    - `POST /api/articles/{id}/comments`: Add a comment (authenticated).
    - `GET /api/articles/{id}/interactions`: Get like/dislike counts and user's interaction.
    - `GET /api/articles?category_id={uuid}&tags={name1,name2}`: Filter articles (NEW).
    - `GET /api/categories`: Get all categories with article counts (NEW).
    - `GET /api/tags?popular=true&limit=15`: Get tags with counts (UPDATED).

## 5. Acceptance Criteria

### 5.1. Master-Detail Layout (MUST PASS)
- **AC-1.1**: Article list is displayed on the left (30% width on desktop).
- **AC-1.2**: Selected article detail is displayed on the right (70% width on desktop).
- **AC-1.3**: Direct link to an article (e.g. from Home Page) opens the page with that article selected and loaded in the Detail panel.

### 5.2. Interactions (MUST PASS)
- **AC-2.1**: User can click Like/Dislike. Counter updates.
- **AC-2.2**: User can view comments.
- **AC-2.3**: User can post a comment.
- **AC-2.4**: Unauthenticated user can see interaction controls (Like/Comment).
- **AC-2.5**: When unauthenticated user views an article, system displays a **persistent banner** at the bottom of the article view panel informing them they must login to comment or like. **No API call** is initiated on interaction attempts.

### 5.3. Filtering (MUST PASS)
- **AC-3.1**: Category filter displays all categories with article counts.
- **AC-3.2**: Tag filter displays 10-15 popular tags initially with "Show all" button.
- **AC-3.3**: Clicking a category filters articles to that category only.
- **AC-3.4**: Clicking tags adds them to active filters (multiple tags use OR logic).
- **AC-3.5**: Active filters are displayed with remove buttons.
- **AC-3.6**: "Clear all filters" button removes all active filters.
- **AC-3.7**: Filter state is preserved in URL query parameters.
- **AC-3.8**: Empty state is shown when no articles match filters.
- **AC-3.9**: On mobile, filters are in a collapsible drawer.

## 6. Verification & Testing Guide

### 6.1. Automated Tests
- **E2E Test**: `web/tests/req-013-article-view.spec.ts`
    - Verify Master-Detail switching.
    - Verify "Read more" navigation.
    - Verify Like/Comment UI interactions.
- **E2E Test**: `web/tests/req-013-article-filters.spec.ts` (NEW)
    - Verify category filtering.
    - Verify tag filtering (single and multiple).
    - Verify combined category + tag filtering.
    - Verify clear filters.
    - Verify URL state persistence.
    - Verify empty state.
- **Backend Test**: Integration tests for Likes and Comments APIs.
- **Backend Test**: Integration tests for filtered article queries (NEW).

## 7. Traceability
- **Dependencies**: REQ-010 (Categories), REQ-012 (Tags, Public List)

