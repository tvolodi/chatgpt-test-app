# DOCUMENT_TYPE: REQUIREMENT
# REQ_ID: REQ-009
# VERSION: 1.0

## 1. Summary

- Title: Categories Management
- Type: functional
- Priority: high
- Status: implemented

## 6. Implementation Status

### Database Schema
- ✅ Table `categories` created with `id`, `code`, `name`, `parent_id`, `deleted_at`.
- ✅ Migration: `api/migrations/000002_create_categories_table.up.sql`.

### Backend
- ✅ Repository: `api/internal/modules/categories/repository.go` (CRUD + Soft Delete).
- ✅ Service: `api/internal/modules/categories/service.go`.
- ✅ Handler: `api/internal/modules/categories/handler.go`.
- ✅ Integration Tests: `api/internal/modules/categories/repository_integration_test.go` (Passed).

### Frontend
- ✅ Tree Component: `web/src/app/components/categories/CategoryTree.tsx`.
    - "New Category" button allows creating a child of the selected category.
- ✅ Form Component: `web/src/app/components/categories/CategoryForm.tsx`.
    - Pre-fills parent category when creating from the tree view.
- ✅ Page: `web/src/app/[locale]/dashboard/categories/page.tsx`.

## 7. Traceability

- **Related ADRs**: ADR-0002 (Database Localization)
- **Related Modules**: MOD-BE-Categories, MOD-FE-Categories
- **Tests**:
    - Backend: `api/internal/modules/categories/repository_integration_test.go`
    - E2E: `web/tests/categories.spec.ts`

## 3. Data Model

### Attributes

| Attribute | Type | Constraints | Description |
| :--- | :--- | :--- | :--- |
| **Id** | UUID | Primary Key | Unique identifier for the category. Automatically generated. |
| **Code** | Text | Unique, Not Null | A system-unique slug for the category (e.g., `software-development`, `web`). Used for URLs. |
| **Name** | JSONB | Not Null, Default `{}` | Localized display name. Follows **ADR-0002**. |
| **ParentId** | UUID | Foreign Key (Self) | Reference to the parent category. Nullable (for root categories). |
| **DeletedAt** | Timestamp | Nullable | Timestamp when the category was soft-deleted. Null means active. |

### Relationships
- **Self-Referencing**: A category can have one parent and multiple children.
- **On Delete**: Soft delete. If a parent is soft-deleted, its children remain but might become "orphaned" or hidden depending on logic (Decision: Hide children of deleted parents in tree).

## 4. User Stories

- **US-1**: As an Admin/Content Manager, I want to view categories in a hierarchical tree structure so I can understand the organization.
- **US-2**: As an Admin/Content Manager, I want to add a new category, optionally selecting a parent.
- **US-3**: As an Admin/Content Manager, I want to update a category's name or move it to a different parent.
- **US-4**: As an Admin/Content Manager, I want to soft-delete a category so I can restore it if needed.

## 5. Functional Requirements

### 5.1. Master-Detail UI
- **FR-1**: The UI must be a **Master-Detail** layout.
    - **Master (Left)**: A collapsible tree view of all categories.
    - **Detail (Right)**: A form to view/edit the selected category or create a new one.

### 5.2. Tree View (Master)
- **FR-2**: Display hierarchy visually (indentation or collapsible nodes).
- **FR-3**: Display localized names in the tree.
- **FR-4**: Allow selection of a node to populate the Detail view.
- **FR-5**: Filter out soft-deleted categories by default.

### 5.3. Detail Form
- **FR-6**: **Code Field**: Unique text identifier.
- **FR-7**: **Name Fields**: Localized inputs (EN, RU, KK).
- **FR-8**: **Parent Selection**: A dropdown or tree-select to choose the parent category.

### 5.4. Actions
- **FR-9**: **Create**: Button to add a root category or child of selected category.
- **FR-10**: **Update**: Save changes to the selected category.
- **FR-11**: **Delete**: Soft delete the category.
    - *Constraint*: Prevent deletion if the category has active children.

## 7. UI Specification

> **Design Subsystem Files:**
> - UI Manifest: [`docs/design/pages/UI-REQ-009-categories.json`](../design/pages/UI-REQ-009-categories.json)
> - Components: [`docs/design/components/COMPONENT-REGISTRY.json`](../design/components/COMPONENT-REGISTRY.json)
> - Design Tokens: [`docs/design/tokens/DESIGN-TOKENS.json`](../design/tokens/DESIGN-TOKENS.json)

Refer to the linked JSON files for detailed UI component structure, styling classes, and layout specifications.

## 8. Traceability

- **Related ADRs**: ADR-0002 (Database Localization)
- **Related Modules**: MOD-BE-Categories, MOD-FE-Categories
